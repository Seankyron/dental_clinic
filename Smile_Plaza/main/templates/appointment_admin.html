<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='appointment_admin.css') }}">
    <title>Appointment Admin</title>
</head>
<body>
<div class="appointment_admin-img">
    <img src="{{ url_for('static', filename='images/logo.png') }}">
    <h4 class="smile-text">Smile Plaza Dental Center</h4>
</div>

<div class="main-container">
    <!-- Calendar Section -->
    <div class="calendar">
        <div class="header">
            <button id="prevMonth"><</button>
            <h3 id="monthYear"></h3>
            <button id="nextMonth">></button>
          </div>
          <div class="weekdays">
            <div>Sun</div>
            <div>Mon</div>
            <div>Tue</div>
            <div>Wed</div>
            <div>Thu</div>
            <div>Fri</div>
            <div>Sat</div>
          </div>
          <div class="days" id="days"></div>
    </div>
    
    <div class="existing-container" id="existing-container" style="display: none">
      <div class="container">
        <div class="row">
            <div class="col md-12">
                <div class="jumbotron p-3">
                    <h4>Manage <b>Appointments</b> </h4>

                   <table class="table table-hover table-dark">
                    <thead> <!-- Add the header row here -->
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Phone</th>
                            <th>Action</th>
                        </tr>
                    </thead>

                    <tr>

                        <td>
                            <a href="" class="btn btn-warning btn-xs" onclick="return confirm('Are you sure to Accept')">âœ“</a>
                            <a href="" class="btn btn-danger btn-xs" onclick="return confirm('Are You Sure To Reject')">X</a>
                        </td>

                    </tr>
                   </table>
                </div>
            </div>
        </div>
      </div>
    </div>
      <div class="load" id="load" style="display: block">
        <h4>Appointment</h4></div>
      <div class="disabledSlots" id="disabledSlots" style="display: none">
        <h4>No appointments for today</h4>
      </div>
</div>
    <script src="https://unpkg.com/scrollreveal"></script>
    <script type="text/javascript" src="js/script.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.12"></script>
    <script>

const monthYearElement = document.getElementById('monthYear');
const daysElement = document.getElementById('days');
const prevMonthBtn = document.getElementById('prevMonth');
const nextMonthBtn = document.getElementById('nextMonth');

let currentDate = new Date();
let currentYear = currentDate.getFullYear();
let currentMonth = currentDate.getMonth();

function updateCalendar(year, month) {
  const daysInMonth = new Date(year, month + 1, 0).getDate();
  const firstDayOfMonth = new Date(year, month, 1).getDay();
  const lastDayOfMonth = new Date(year, month + 1, 0).getDay();
  
  monthYearElement.textContent = `${getMonthName(month)} ${year}`;

  daysElement.innerHTML = '';
  for (let i = 0; i < firstDayOfMonth; i++) {
    const emptyDay = document.createElement('div');
    emptyDay.classList.add('emptyDay')
    daysElement.appendChild(emptyDay);
  }

  for (let day = 1; day <= daysInMonth; day++) {
    const dayDiv = document.createElement('div');
    dayDiv.textContent = day;

    const dayOfWeek = new Date(year, month, day).getDay();
    if (dayOfWeek === 0 || dayOfWeek === 1 || dayOfWeek === 6) {
      dayDiv.classList.add('disabled'); // You can style these days as disabled
      dayDiv.addEventListener('click', async () => {
        if (dayDiv.classList.contains('disabled') || emptyDay.classList.contains('emptyDay')) {
          document.getElementById('existing-container').style.display = 'none';
          document.getElementById('disabledSlots').style.display = 'block';
        } 
      })
    } 
    else {
      dayDiv.addEventListener('click', async () => {
        // Only call showAvailableSlots for enabled days
        if (!dayDiv.classList.contains('disabled')) {
          document.getElementById('existing-container').style.display = 'block';
          document.getElementById('load').style.display = 'none';
          document.getElementById('disabledSlots').style.display = 'none';
          await showAppointment(selectedDate);
        } 
      });
    }

    daysElement.appendChild(dayDiv);
  }

  for (let i = 6; i > lastDayOfMonth; i--) {
    const emptyDayafter = document.createElement('div');
    emptyDayafter.classList.add('emptyDayafter')
    daysElement.appendChild(emptyDayafter);
  }
}

function getMonthName(month) {
  const monthNames = [
    'January', 'February', 'March', 'April', 'May', 'June',
    'July', 'August', 'September', 'October', 'November', 'December'
  ];
  return monthNames[month];
}

function goToPreviousMonth() {
  currentMonth--;
  if (currentMonth < 0) {
    currentMonth = 11;
    currentYear--;
  }
  updateCalendar(currentYear, currentMonth);
}

function goToNextMonth() {
  currentMonth++;
  if (currentMonth > 11) {
    currentMonth = 0;
    currentYear++;
  }
  updateCalendar(currentYear, currentMonth);
}

prevMonthBtn.addEventListener('click', goToPreviousMonth);
nextMonthBtn.addEventListener('click', goToNextMonth);

updateCalendar(currentYear, currentMonth);

async function getAvailableTimeSlots(selectedDate) {
    try {
        const response = await fetch('/get_appointment_data', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ selectedDate: selectedDate}),
        });

        if (!response.ok) {
            throw new Error('Network response was not ok');
        }

        const data = await response.json();
        return data.availableTimes;
    } catch (error) {
        console.error('Error fetching occupied times:', error);
        return [];
    }
}

// Array to store customer information
let customers = showAppointment(selectedDate);

function displayCustomersForDate(selectedDate) {
    // Use JavaScript to dynamically fetch customer data from Flask backend
    fetch(`/get_customers_by_date?date=${selectedDate}`)
        .then(response => response.json())
        .then(customers => {
            // Display customers in the table
            let tableBody = document.querySelector('.table tbody');
            tableBody.innerHTML = '';

            customers.forEach(customer => {
                let row = `
                    <tr>
                        <td>${customer.id}</td>
                        <td>${customer.name}</td>
                        <td>${customer.email}</td>
                        <td>${customer.phone}</td>
                        <td>
                            <a href="#" class="btn btn-warning btn-xs" onclick="editCustomer('${customer.id}')">Accept</a>
                            <a href="#" class="btn btn-danger btn-xs" onclick="deleteCustomer('${customer.id}')">Reject</a>
                        </td>
                    </tr>
                `;
                tableBody.innerHTML += row;
            });
        })
        .catch(error => console.error('Error fetching customer data:', error));
}

// Function to display appointment info for selected date
async function showAppointment(selectedDate) {
    // Use JavaScript to dynamically fetch appointment data from Flask backend
    const response = await fetch('/get_appointment_data', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ selectedDate: selectedDate}),
        });  
        .catch(error => console.error('Error fetching appointment data:', error));
}

// Initial display of customers
displayCustomers();
    </script>

{% extends "admin_nav.html" %}
{% block content %}
{% endblock content %}

</body>
</html>